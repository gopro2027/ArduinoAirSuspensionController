; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

; Please choose your device by uncommenting the appropriate line below
[platformio]
default_envs = controller_ws2p8b_dev

[env]
; platform = platformio/espressif32
; platform = https://github.com/platformio/platform-espressif32.git
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip
framework = arduino

monitor_speed = 115200
monitor_rts = 0
monitor_dtr = 0
monitor_filters = esp32_exception_decoder

build_flags =
    -Wall
    ; these 2 lines are needed for lvgl 9.3.0
    ; -I include  ; Add the include/ folder to the search path, needed for lvgl 9.3.0
    ; -DLV_CONF_PATH=\"lv_conf.h\"  ;Define LV_CONF_PATH as a quoted filename,  this version is needed for lvgl 9.3.0 but doesn't work in 9.2.2
    '-D LV_CONF_PATH=${platformio.include_dir}/lv_conf.h' ; This version works with lvgl 9.2.2
    '-D BOARD_NAME="${this.board}"'
    '-D CORE_DEBUG_LEVEL=ARDUHAL_LOG_LEVEL_INFO'
    ;'-D CORE_DEBUG_LEVEL=5'
    '-D PROJECT_IS_CONTROLLER'
    ;'-D CORE_DEBUG_LEVEL=ARDUHAL_LOG_LEVEL_DEBUG'
    ;'-D CORE_DEBUG_LEVEL=ARDUHAL_LOG_LEVEL_VERBOSE'
    '-D NAVBAR_HEIGHT=(37*SCALE_Y)'

lib_extra_dirs = ../ESP32_SHARED_LIBS/
    

board_build.partitions = no_fs.csv ;min_spiffs.csv ;huge_app.csv
    
lib_deps =
    ;
    h2zero/NimBLE-Arduino@^2.1.0
    ;
    ;
    lvgl/lvgl@9.2.2 # must use exactly 9.2.2 until our config file is fixed to work with 9.3.0
    ;
    ; ;
    ; lvgl/lvgl@9.3.0
    bblanchon/ArduinoJson@^7.4.2
    ;
    

; monitor_port = COM5
; upload_port = COM5


; setup per device environments

[env:controller_ws2p8_dev]
extends = env
board = esp32-s3touchlcd2p8
board_build.partitions = partitions/s3_16mb.csv
build_flags = ${env.build_flags} 
    '-D FIRMWARE_RELEASE_NAME="controller_ws2p8"'
    '-D CONFIG_BT_NIMBLE_MEM_ALLOC_MODE_EXTERNAL=1' ; Fix malloc error in Nim-BLE by making it use the SPIRAM
    '-D OTA_SUPPORTED'
lib_deps = ${env.lib_deps}
    ./device_libs/ws2p8

[env:controller_ws2p8b_dev]
extends = env
board = esp32-s3touchlcd2p8b
board_build.partitions = partitions/s3_16mb.csv
build_flags = ${env.build_flags} 
    '-D FIRMWARE_RELEASE_NAME="controller_ws2p8b"'
    '-D CONFIG_BT_NIMBLE_MEM_ALLOC_MODE_EXTERNAL=1' ; Fix malloc error in Nim-BLE by making it use the SPIRAM
    '-D OTA_SUPPORTED'
lib_deps = ${env.lib_deps}
    ./device_libs/ws2p8b

[env:controller_ws3p5b_dev]
extends = env
board = esp32-s3touchlcd3p5b
board_build.partitions = partitions/s3_16mb.csv
build_flags = ${env.build_flags} 
    '-D FIRMWARE_RELEASE_NAME="controller_ws3p5b"'
    '-D CONFIG_BT_NIMBLE_MEM_ALLOC_MODE_EXTERNAL=1' ; Fix malloc error in Nim-BLE by making it use the SPIRAM
    '-D OTA_SUPPORTED'
    '-D WAVESHARE_BOARD_3p5' ; unsure how necessary this is, was in shaft's pr
    '-DLV_COLOR_DEPTH=16'
    '-DLV_COLOR_SCREEN_TRANSP=0'
    '-DLV_COLOR_16_SWAP=0'
lib_deps = ${env.lib_deps}
    ./device_libs/ws3p5b
    









; setup release envs
[env:release]
build_flags = 
    '-D OFFICIAL_RELEASE'
    '-D RELEASE_VERSION=${sysenv.version_num}'

[env:controller_ws2p8_release]
extends = env:controller_ws2p8_dev
build_flags = ${env:controller_ws2p8_dev.build_flags}
    ${env:release.build_flags}


[env:controller_ws2p8b_release]
extends = env:controller_ws2p8b_dev
build_flags = ${env:controller_ws2p8b_dev.build_flags}
    ${env:release.build_flags}


[env:controller_ws3p5b_release]
extends = env:controller_ws3p5b_dev
build_flags = ${env:controller_ws3p5b_dev.build_flags}
    ${env:release.build_flags}